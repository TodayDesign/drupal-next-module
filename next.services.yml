services:
  plugin.manager.next.site_resolver:
    class: Today\next\Plugin\SiteResolverManager
    parent: default_plugin_manager
  plugin.manager.next.site_previewer:
    class: Today\next\Plugin\SitePreviewerManager
    parent: default_plugin_manager
  plugin.manager.next.preview_url_generator:
    class: Today\next\Plugin\PreviewUrlGeneratorManager
    parent: default_plugin_manager
  plugin.manager.next.revalidator:
    class: Today\next\Plugin\RevalidatorManager
    parent: default_plugin_manager
  next.entity_type.manager:
    class: Today\next\NextEntityTypeManager
    arguments: ["@entity_type.manager"]
  next.settings.manager:
    class: Today\next\NextSettingsManager
    arguments:
      [
        "@config.factory",
        "@plugin.manager.next.site_previewer",
        "@plugin.manager.next.preview_url_generator",
      ]
  next.preview_secret_generator:
    class: Today\next\PreviewSecretGenerator
    arguments: ["@private_key"]
  next.main_content_renderer.html:
    class: Today\next\Render\MainContent\HtmlRenderer
    decorates: main_content_renderer.html
    arguments:
      [
        "@title_resolver",
        "@plugin.manager.display_variant",
        "@event_dispatcher",
        "@module_handler",
        "@renderer",
        "@render_cache",
        "%renderer.config%",
        "@config.factory",
        "@next.entity_type.manager",
        "@plugin.manager.next.site_previewer",
        "@theme.manager",
      ]
    tags:
      - { name: render.main_content_renderer, format: html }
  next.uninstall_validator:
    class: Today\next\NextUninstallValidator
    tags:
      - { name: module_install.uninstall_validator }
    arguments:
      ["@plugin.manager.next.preview_url_generator", "@next.settings.manager"]
    lazy: true
  logger.channel.next:
    parent: logger.channel_base
    arguments: ["next"]
  next.entity_action_event_revalidate_subscriber:
    class: Today\next\EventSubscriber\EntityActionEventRevalidateSubscriber
    arguments:
      [
        "@next.entity_type.manager",
        "@next.settings.manager",
        "@logger.channel.next",
        "@event_dispatcher",
      ]
    tags:
      - { name: event_subscriber }
